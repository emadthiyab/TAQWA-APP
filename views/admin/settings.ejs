<!DOCTYPE html>
<html lang="<%= lang %>" dir="<%= dir %>">

<head>
    <%- include('../partials/head') %>
        <style>
            .settings-section {
                border-left: 4px solid var(--gold);
                padding-left: 1rem;
                margin-bottom: 2rem;
            }

            .feature-toggle {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 1rem;
                border: 1px solid #e9ecef;
                border-radius: 8px;
                margin-bottom: 1rem;
            }
        </style>
</head>

<body class="dashboard-bg">
    <%- include('../partials/sidebar') %>

        <div class="main-content">
            <%- include('../partials/navbar', { title: lang==='ar' ? 'الإعدادات' : 'Settings' }) %>

                <div class="container-fluid py-4">
                    <!-- رسائل النجاح/الخطأ -->
                    <% if (success) { %>
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            <i class="fas fa-check-circle me-2"></i>
                            <%= lang==='ar' ? 'تم تحديث الإعدادات بنجاح!' : 'Settings updated successfully!' %>
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                        <% } %>

                            <% if (error) { %>
                                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    <%= lang==='ar' ? 'حدث خطأ أثناء تحديث الإعدادات'
                                        : 'An error occurred while updating settings' %>
                                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                </div>
                                <% } %>

                                    <div class="row">
                                        <div class="col-lg-8">
                                            <div class="luxury-card p-4 mb-4">
                                                <h5 class="text-gold mb-4">
                                                    <i class="fas fa-cog me-2"></i>
                                                    <%= lang==='ar' ? 'الإعدادات العامة' : 'General Settings' %>
                                                </h5>

                                                <form action="/admin/settings?lang=<%= lang %>" method="POST">
                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">
                                                                <%= lang==='ar' ? 'اسم الفندق' : 'Hotel Name' %>
                                                            </label>
                                                            <input type="text" class="form-control" name="hotelName"
                                                                value="<%= settings.hotelName || 'فندق دار التقوى' %>"
                                                                required>
                                                        </div>

                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">
                                                                <%= lang==='ar' ? 'اللغة الافتراضية'
                                                                    : 'Default Language' %>
                                                            </label>
                                                            <select class="form-select" name="defaultLanguage" required>
                                                                <option value="ar" <%=settings.defaultLanguage==='ar'
                                                                    ? 'selected' : '' %>>
                                                                    <%= lang==='ar' ? 'العربية' : 'Arabic' %>
                                                                </option>
                                                                <option value="en" <%=settings.defaultLanguage==='en'
                                                                    ? 'selected' : '' %>>
                                                                    <%= lang==='ar' ? 'الإنجليزية' : 'English' %>
                                                                </option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div class="mb-3">
                                                        <label class="form-label">
                                                            <%= lang==='ar' ? 'المنطقة الزمنية' : 'Time Zone' %>
                                                        </label>
                                                        <select class="form-select" name="timeZone" required>
                                                            <option value="Asia/Riyadh"
                                                                <%=settings.timeZone==='Asia/Riyadh' ? 'selected' : ''
                                                                %>>(GMT+3) الرياض</option>
                                                            <option value="Asia/Dubai"
                                                                <%=settings.timeZone==='Asia/Dubai' ? 'selected' : '' %>
                                                                >(GMT+4) دبي</option>
                                                            <option value="Europe/London"
                                                                <%=settings.timeZone==='Europe/London' ? 'selected' : ''
                                                                %>>(GMT+0) لندن</option>
                                                            <option value="America/New_York"
                                                                <%=settings.timeZone==='America/New_York' ? 'selected'
                                                                : '' %>>(GMT-5) نيويورك</option>
                                                        </select>
                                                    </div>

                                                    <div class="settings-section mt-4">
                                                        <h6 class="text-dark mb-3">
                                                            <i class="fas fa-feather me-2"></i>
                                                            <%= lang==='ar' ? 'الميزات المتقدمة' : 'Advanced Features'
                                                                %>
                                                        </h6>

                                                        <div class="feature-toggle">
                                                            <div>
                                                                <h6 class="mb-1">
                                                                    <%= lang==='ar' ? 'المصادقة الثنائية'
                                                                        : 'Two-Factor Authentication' %>
                                                                </h6>
                                                                <p class="text-muted mb-0 small">
                                                                    <%= lang==='ar'
                                                                        ? 'تفعيل المصادقة الثنائية لزيادة الأمان'
                                                                        : 'Enable two-factor authentication for enhanced security'
                                                                        %>
                                                                </p>
                                                            </div>
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox"
                                                                    name="twoFactorAuth"
                                                                    <%=settings.features.twoFactorAuth ? 'checked' : ''
                                                                    %>>
                                                            </div>
                                                        </div>

                                                        <div class="feature-toggle">
                                                            <div>
                                                                <h6 class="mb-1">
                                                                    <%= lang==='ar' ? 'النسخ الاحتياطي التلقائي'
                                                                        : 'Auto Backup' %>
                                                                </h6>
                                                                <p class="text-muted mb-0 small">
                                                                    <%= lang==='ar'
                                                                        ? 'نسخ احتياطي تلقائي للبيانات يومياً'
                                                                        : 'Automatic daily backup of system data' %>
                                                                </p>
                                                            </div>
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox"
                                                                    name="autoBackup" <%=settings.features.autoBackup
                                                                    ? 'checked' : '' %>>
                                                            </div>
                                                        </div>

                                                        <div class="feature-toggle">
                                                            <div>
                                                                <h6 class="mb-1">
                                                                    <%= lang==='ar' ? 'الإشعارات البريدية'
                                                                        : 'Email Notifications' %>
                                                                </h6>
                                                                <p class="text-muted mb-0 small">
                                                                    <%= lang==='ar'
                                                                        ? 'إرسال إشعارات عبر البريد الإلكتروني'
                                                                        : 'Send notifications via email' %>
                                                                </p>
                                                            </div>
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox"
                                                                    name="emailNotifications"
                                                                    <%=settings.features.emailNotifications ? 'checked'
                                                                    : '' %>>
                                                            </div>
                                                        </div>

                                                        <div class="feature-toggle">
                                                            <div>
                                                                <h6 class="mb-1">
                                                                    <%= lang==='ar' ? 'الإشعارات النصية'
                                                                        : 'SMS Notifications' %>
                                                                </h6>
                                                                <p class="text-muted mb-0 small">
                                                                    <%= lang==='ar' ? 'إرسال إشعارات عبر الرسائل النصية'
                                                                        : 'Send notifications via SMS' %>
                                                                </p>
                                                            </div>
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox"
                                                                    name="smsNotifications"
                                                                    <%=settings.features.smsNotifications ? 'checked'
                                                                    : '' %>>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="mt-4">
                                                        <button type="submit" class="btn btn-luxury">
                                                            <i class="fas fa-save me-2"></i>
                                                            <%= lang==='ar' ? 'حفظ الإعدادات' : 'Save Settings' %>
                                                        </button>
                                                        <button type="reset" class="btn btn-outline-secondary ms-2">
                                                            <i class="fas fa-undo me-2"></i>
                                                            <%= lang==='ar' ? 'إعادة تعيين' : 'Reset' %>
                                                        </button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>

                                        <div class="col-lg-4">
                                            <!-- معلومات النظام -->
                                            <div class="luxury-card p-4 mb-4">
                                                <h5 class="text-gold mb-3">
                                                    <i class="fas fa-info-circle me-2"></i>
                                                    <%= lang==='ar' ? 'معلومات النظام' : 'System Information' %>
                                                </h5>

                                                <div class="mb-3">
                                                    <h6 class="text-dark">
                                                        <%= lang==='ar' ? 'إصدار النظام:' : 'System Version:' %>
                                                    </h6>
                                                    <p class="text-muted">v1.0.0</p>
                                                </div>

                                                <div class="mb-3">
                                                    <h6 class="text-dark">
                                                        <%= lang==='ar' ? 'تاريخ التثبيت:' : 'Installation Date:' %>
                                                    </h6>
                                                    <p class="text-muted">
                                                        <%= new Date().toLocaleDateString(lang==='ar' ? 'ar-SA'
                                                            : 'en-US' ) %>
                                                    </p>
                                                </div>

                                                <div class="mb-3">
                                                    <h6 class="text-dark">
                                                        <%= lang==='ar' ? 'آخر تحديث:' : 'Last Update:' %>
                                                    </h6>
                                                    <p class="text-muted">
                                                        <%= new Date().toLocaleDateString(lang==='ar' ? 'ar-SA'
                                                            : 'en-US' ) %>
                                                    </p>
                                                </div>

                                                <div class="mb-3">
                                                    <h6 class="text-dark">
                                                        <%= lang==='ar' ? 'حالة النظام:' : 'System Status:' %>
                                                    </h6>
                                                    <span class="badge bg-success">
                                                        <i class="fas fa-check-circle me-1"></i>
                                                        <%= lang==='ar' ? 'يعمل بشكل طبيعي' : 'Operational' %>
                                                    </span>
                                                </div>
                                            </div>

                                            <!-- إجراءات سريعة -->
                                            <div class="luxury-card p-4">
                                                <h5 class="text-gold mb-3">
                                                    <i class="fas fa-bolt me-2"></i>
                                                    <%= lang==='ar' ? 'إجراءات سريعة' : 'Quick Actions' %>
                                                </h5>

                                                <div class="d-grid gap-2">
                                                    <a href="/admin/import?lang=<%= lang %>"
                                                        class="btn btn-outline-luxury text-start">
                                                        <i class="fas fa-database me-2"></i>
                                                        <%= lang==='ar' ? 'استيراد البيانات' : 'Import Data' %>
                                                    </a>

                                                    <a href="/admin/analytics?lang=<%= lang %>"
                                                        class="btn btn-outline-luxury text-start">
                                                        <i class="fas fa-chart-bar me-2"></i>
                                                        <%= lang==='ar' ? 'التقارير والتحليلات' : 'Reports & Analytics'
                                                            %>
                                                    </a>

                                                    <button class="btn btn-outline-luxury text-start"
                                                        onclick="backupSystem()">
                                                        <i class="fas fa-download me-2"></i>
                                                        <%= lang==='ar' ? 'نسخ احتياطي' : 'Backup System' %>
                                                    </button>

                                                    <button class="btn btn-outline-danger text-start"
                                                        onclick="clearCache()">
                                                        <i class="fas fa-broom me-2"></i>
                                                        <%= lang==='ar' ? 'مسح الذاكرة المؤقتة' : 'Clear Cache' %>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                </div>
        </div>

        <%- include('../partials/scripts') %>

            <script>
                function backupSystem() {
                    if (confirm('<%= lang === 'ar' ? 'هل تريد إنشاء نسخة احتياطية للنظام؟' : 'Do you want to create a system backup ? ' %>')) {
                        // محاكاة عملية النسخ الاحتياطي
                        const alert = document.createElement('div');
                        alert.className = 'alert alert-info alert-dismissible fade show';
                        alert.innerHTML = `
                    <i class="fas fa-info-circle me-2"></i>
                    <%= lang === 'ar' ? 'جاري إنشاء النسخة الاحتياطية...' : 'Creating backup...' %>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                        document.querySelector('.container-fluid').insertBefore(alert, document.querySelector('.container-fluid').firstChild);

                        setTimeout(() => {
                            alert.className = 'alert alert-success alert-dismissible fade show';
                            alert.innerHTML = `
                        <i class="fas fa-check-circle me-2"></i>
                        <%= lang === 'ar' ? 'تم إنشاء النسخة الاحتياطية بنجاح' : 'Backup created successfully' %>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    `;
                        }, 2000);
                    }
                }

                function clearCache() {
                    if (confirm('<%= lang === 'ar' ? 'هل تريد مسح الذاكرة المؤقتة؟' : 'Do you want to clear the cache ? ' %>')) {
                        // محاكاة مسح الذاكرة المؤقتة
                        const alert = document.createElement('div');
                        alert.className = 'alert alert-info alert-dismissible fade show';
                        alert.innerHTML = `
                    <i class="fas fa-info-circle me-2"></i>
                    <%= lang === 'ar' ? 'جاري مسح الذاكرة المؤقتة...' : 'Clearing cache...' %>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                        document.querySelector('.container-fluid').insertBefore(alert, document.querySelector('.container-fluid').firstChild);

                        setTimeout(() => {
                            alert.className = 'alert alert-success alert-dismissible fade show';
                            alert.innerHTML = `
                        <i class="fas fa-check-circle me-2"></i>
                        <%= lang === 'ar' ? 'تم مسح الذاكرة المؤقتة بنجاح' : 'Cache cleared successfully' %>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    `;
                        }, 1500);
                    }
                }

                // إضافة تأثيرات للتبديل بين الميزات
                document.addEventListener('DOMContentLoaded', function () {
                    const switches = document.querySelectorAll('.form-check-input');
                    switches.forEach(switchEl => {
                        switchEl.addEventListener('change', function () {
                            const label = this.closest('.feature-toggle').querySelector('h6');
                            if (this.checked) {
                                label.classList.add('text-gold');
                            } else {
                                label.classList.remove('text-gold');
                            }
                        });
                    });
                });
            </script>
</body>

</html>